// ============================================
// Ebdaa v3 โ Prompt Engine ULTRA
// ูุชุฎุตุต: ููุงุจุณ + ุจููุชู + ููุชุฌุงุช ููุฒููุฉ
// ูุธุงู 2 Calls: Enrichment โ Generation
// ============================================

import { ProductFormData } from '../types/ad.types'
import { DYNAMIC_STYLES } from '../../../lib/dynamicTemplates'

// โโโ ููุงุนุฏ ุงููุบุฉ ุงูุนุงูุฉ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
const LANGUAGE_RULES = `
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ููุงุนุฏ ุงููุบุฉ โ ููููุน ุชุฎุงูููุง:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ููููุน ุงููุตุญู ุฎุงูุต โ ุญุชู ูููุฉ ูุงุญุฏุฉ
โ ููููุน: ุฑุงุฆุน / ูููุฒ / ุงุณุชุซูุงุฆู / ูุฑูุฏ / ุนุงูู ุงูุฌูุฏุฉ / ููุฏู ููู / ููุชุฌูุง
โ ููููุน ุงูู headline ูุฒูุฏ ุนู 6 ูููุงุช
โ ููููุน ุฃู ุฅุนูุงููู ูุจุฏุฃูุง ุจููุณ ุงููููุฉ
โ ููููุน ุงูููุงู ุงูุนุงู ุงููู ูููุน ูุฃู ููุชุฌ ุชุงูู

โ ุงูุชุจ ุจุงูุนุงููุฉ ุงููุตุฑูุฉ ุฒู ูุง ุงููุงุณ ุจุชูุชุจ ูู ูุงุชุณุงุจ
โ ูู ุฌููุฉ ูุงุฒู ุชุฎุฏู ุงูุจูุน ูุจุงุดุฑุฉ โ ูููุด ููุงู ุฒูุงุฏุฉ
โ ุงุณุชุฎุฏู ุฃุฑูุงู ูุชูุงุตูู ุญููููุฉ ูู ุจูุงูุงุช ุงูููุชุฌ
โ ูู ุฅุนูุงู ููู ุตูุช ูุดุฎุตูุฉ ูุฎุชููุฉ ุชูุงูุงู
โ ุงูู primaryText ูุจุฏุฃ ุจุฌููุฉ ุชุฎูู ุงููุงุญุฏ ูููู ุฅุตุจุนู ููุฑุงู
`

const DYNAMIC_TEMPLATES_INSTRUCTION = `
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ุงูููุงูุจ ุงูุฏููุงููููุฉ ููุตูุฑ (Dynamic Templates):
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ูุฐู ูู ุงูููุงูุจ ุงููุชุงุญุฉ ูุฅูุดุงุก ุงูุตูุฑ:
${JSON.stringify(DYNAMIC_STYLES.map(s => ({ id: s.id, name: s.styleName, prompt: s.dynamicPrompt })), null, 2)}

ูููุชู ูู ุญูู imagePrompt:
1. ุงุฎุชุฑ ุฃูุณุจ ูุงูุจ ูู ุงูููุงูุจ ุจุงูุฃุนูู ุจูุงุกู ุนูู ุงูููุชุฌ.
2. ูู ุจุชุนุจุฆุฉ ุฌููุน ุงููุชุบูุฑุงุช ุงููุทููุจุฉ ูู ุงููุงูุจ ุงููุฎุชุงุฑ ุจูููุงุช ุฅุจุฏุงุนูุฉ.
3. ุงุณุชุจุฏู ุงูุฃููุงุณ ุงููุฑุจุนุฉ ูุงุณู ุงููุชุบูุฑ ุจุงููููุฉ ุงููุทููุจุฉ ูุจุงุดุฑุฉุ ูุซุงู: ุจุฏู [Color_Theme] ุถุน red.
4. ุฃุฑุฌุน ุงููุต ุงูููุงุฆู ูููุงูุจ ุงููุฎุชุงุฑ ุจุนุฏ ุชุนุจุฆุชู ุจุงููุงูู ููููุฉ ุงูู imagePrompt.
`

// โโโ Formulas ููู ุฒุงููุฉ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
const ANGLE_FORMULAS = `
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ุงูุฒุงููุฉ 1 โ ุชุฃุซูุฑ ุงูุฃูู (pain) | Formula: PAS
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
Formula: Problem โ Agitate โ Solve
ุงููุฏู: ุงููุงุญุฏ ููุฑุฃ ุงูุฌููุฉ ุงูุฃููู ููุญุณ ุฅูู ุจุชุชููู ุนูู ูู ุจุงูุธุจุท.

primaryText:
- ุงุจุฏุฃ ุจูุตู ูุญุธุฉ ุงูุฃูู ุจุงูุชูุตูู (ูุด "ุชุนุงูู ูู X" โ ููู "ููุง ุจุชุตุญู ุงูุตุจุญ ู...")
- ุงูุฌููุฉ ุงูุชุงููุฉ: ูุจูุฑ ุงูุฃูู โ ุฅูู ุงููู ุจูุชุณุจุจ ููู ุฏู ูู ุญูุงุชูุ
- ุงูุฌููุฉ ุงูุชุงูุชุฉ: ุงูุญู ูู ุฌููุฉ ูุงุญุฏุฉ ุญุงุฏุฉ

headline: ุณุคุงู ุจูููุณ ุงูุฌุฑุญ โ ูุด "ูู ุชุนุงููุ" ูุฃุ ููู "ููู ูู ูุง..."

hooks (3 ุฃุนุฑุงุถ ูุฎุชููุฉ ูููุดููุฉ โ ูุด ุญููู):
- ูู hook = ูููู ุญูุงุชู ุญูููู ููู ุงูุฃูู ุฏู
- ูุจุฏุฃ ุจู "ููุง" ุฃู "ูู ูุง" ุฃู "ุจูุงูู"

adPost structure:
๐จ [ุฌููุฉ ุงุณุชูุชุงุญ = ุงูุฃูู]
[ููุฑุฉ ูุตูุฑุฉ: ุงูุฃูู + ุงูุชุถุฎูู]
[ุงูุณุทุฑ ุงููุงุตู: "ุงูุญู ุจูู ููุฌูุฏ โ"]
[ุงุณู ุงูููุชุฌ + ุงููุงูุฏุฉ ุงูุฑุฆูุณูุฉ ูู ุฌููุฉ]
[CTA ุญุงุฏ]

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ุงูุฒุงููุฉ 2 โ ุงููุงุฑู ุงูููุงุณ (compare) | Formula: VS
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
Formula: Before VS After โ ุจุฃุฑูุงู ูุชูุงุตูู
ุงููุฏู: ุงููุงุญุฏ ูุญุณ ุฅู ุงูุงุฎุชูุงุฑ ูุงุถุญ ูุณูู.

primaryText:
- ุงุจุฏุฃ ุจู "ุจุฏู ูุง..." ุฃู "ูุจู ูุง ุชุดุชุฑู..." ุฃู ููุงุฑูุฉ ุฑูููุฉ ูุจุงุดุฑุฉ
- ูุงุฑู ุงูููุชุฌ ุจุงูุจุฏูู ุงูุดุงุฆุน (ูุด "ุฃุญุณู ูู ุงูููุงูุณูู" โ ููู ุจุงูุธุจุท ุฅูู)
- ุงุฎุชู ุจุฌููุฉ ุชุฎูู ุงููุฑุงุฑ ูุจุงู ุณูู

headline: "X ููุงุจู Y" ุฃู "ููู ุงููุงุณ ุจุชูุถู..." โ ุฑูู ุฃู ููุงุฑูุฉ ูุงุถุญุฉ

hooks (3 ููุงุฑูุงุช ูุญุฏุฏุฉ):
- ุฑูู VS ุฑูู
- ูุชูุฌุฉ VS ูุชูุฌุฉ
- ุชุฌุฑุจุฉ VS ุชุฌุฑุจุฉ

adPost structure:
โก [ุฌููุฉ ููุงุฑูุฉ ุตุงุฏูุฉ]
[ุฌุฏูู ุฃู ููุงุท ููุงุฑูุฉ ุณุฑูุนุฉ]
[ูุชูุฌุฉ ูุงุถุญุฉ: "ูุนูู ุฅูู ุฏูุ"]
[CTA]

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ุงูุฒุงููุฉ 3 โ ุงูุงุฏุนุงุก ุงูุฌุฑูุก (bold) | Formula: CLAIM
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
Formula: Big Claim โ Proof โ Challenge
ุงููุฏู: ุชุตุฏู ุงููุงุญุฏ ุจูุชูุฌุฉ ูุง ูุงูุด ูุชููุนูุง.

primaryText:
- ุงุจุฏุฃ ุจุงุฏุนุงุก ุฑููู ุฃู ูุชูุฌุฉ ุตุงุฏูุฉ โ ูุจุงุดุฑ ูุจุฏูู ููุฏูุฉ
- ุงูุฌููุฉ ุงูุชุงููุฉ: ุงูุฏููู (ูู ุฅูู ุฌุงูุฉ ุงููุชูุฌุฉ ุฏูุ)
- ุงูุฌููุฉ ุงูุชุงูุชุฉ: ุชุญุฏู ููุชูุญ "ูู ูุด ุตุงุฏู..."

headline: ุงุฏุนุงุก ูุงุญุฏ ููู โ ุฑูู ุฃู ูุชูุฌุฉ ูุญุฏุฏุฉ ูู 6 ูููุงุช

hooks (3 ุจุฑุงููู ุนูู ุงูุงุฏุนุงุก):
- ูู hook = ุฏููู ูุฎุชูู (ููููุ ูุชูุฌุฉุ ุดูุงุฏุฉ)

adPost structure:
๐ช [ุงูุงุฏุนุงุก ุงูุฌุฑูุก ูุนููุงู]
[ุงูุฏููู: ููู ุงูุงุฏุนุงุก ุฏู ุตุญุ]
[ุชุญุฏู: ุฌุฑุจ ูุงุฑุฌุนููุง]
[ุถูุงู + CTA]

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ุงูุฒุงููุฉ 4 โ ุงูุชุญูู ูุงููุชูุฌุฉ (transform) | Formula: BAB
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
Formula: Before โ After โ Bridge
ุงููุฏู: ุชุฑุณู ุตูุฑุฉ ููุญูุงุฉ ุจุนุฏ ุงุณุชุฎุฏุงู ุงูููุชุฌ.

primaryText:
- ุงุจุฏุฃ ุจู ุตูุฑุฉ ููุญูุงุฉ ุงููุซุงููุฉ ุงููู ุงูุนููู ุจูุชููุงูุง ุงููุฑุชุจุทุฉ ุจุงูููุชุฌ.
- ุงูุฌููุฉ ุงูุชุงููุฉ: ูููุฑู ุจุงูุญูุงุฉ ุงููุฒุนุฌุฉ ุงููู ุนุงูุดูุง ุฏูููุชู ุจุฏูู ุงูููุชุฌ.
- ุงูุฌููุฉ ุงูุชุงูุชุฉ: ุงูููุจุฑู ุงูุณุฑูุน โ ุฅุฒุงู ุงูููุชุฌ ุฏู ูู ุงูุทุฑูู ุงููุจุงุดุฑ ูููุชูุฌุฉ ุฏูุ

headline: ุงููุชูุฌุฉ ุงูููุงุฆูุฉ ูู ุฑูู ุฃู ุญูููุฉ. "ุญูุงุชู ุจุนุฏ X"

hooks (3 ููุงุฆุฏ ูุจุงุดุฑุฉ):
- ูู hook = ูุงุฆุฏุฉ ุจุชุญุตู ููุฑุง ุจุนุฏ ุงูุงุณุชุฎุฏุงู

adPost structure:
โจ [ุตูุฑุฉ ุงูุญูุงุฉ ุงููุซุงููุฉ]
[ุงููุงูุน ุงููุฒุนุฌ ุฏูููุชู]
[ุงูููุชุฌ ูู ุงูุญู ุงูุณุฑูุน]
[CTA]

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ุงูุฒุงููุฉ 5 โ ุงูุนุฑุถ ุงููุจุงุดุฑ (offer) | Formula: FOMO
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
Formula: Direct Offer + Scarcity + Urgency
ุงููุฏู: ุฅููุงุก ุงูุตููุฉ ุฏูููุชู ุญุงูุง.

primaryText:
- ุงุจุฏุฃ ุจู ุงูุนุฑุถ ุงูุตุงุฏู ูุจุงุดุฑุฉ ูุจุฏูู ุฃู ููุฏูุงุช! (ุฎุตูุ ูุฏูุฉุ ุจุงูุฏุฌ).
- ุงูุฌููุฉ ุงูุชุงููุฉ: ุงููุฏุฑุฉ / ุงูุณุจุจ ูุฑุงุก ุงูุนุฑุถ (ุชุตููุฉุ ุนูุฏ ูููุงุฏูุงุ ุขุฎุฑ 50 ูุทุนุฉ).
- ุงูุฌููุฉ ุงูุชุงูุชุฉ: ุญุซ ููุฑู ุนูู ุงุชุฎุงุฐ ุงููุฑุงุฑ (ุงูุนุฑุถ ููุฎูุต ุงููููุฉ ุจุชุฎูุต).

headline: ุงุณู ุงูุนุฑุถ + ูููุฉ ุจุชุฏู ุนูู ุงูุณุฑุนุฉ (ุฎุตู 50% ูุขุฎุฑ ูุทุนุฉ!)

hooks (3 ุฃุณุจุงุจ ููุดุฑุงุก ููุฑุง):
- ูู hook = ุณุจุจ ูุงุฏู ุจูุฎูู ุชุฃุฌูู ุงูุดุฑุงุก ุฎุณุงุฑุฉ

adPost structure:
๐ฅ [ุงุณู ุงูุนุฑุถ ุงูุตุงุฏู]
[ุดุฑุญ ุงูุณุจุจ/ุงููุฏุฑุฉ]
[ุงููููุฉ ุงููุชุจููุฉ / ุงูููุช]
[CTA ููู ูููุญ]
`

// โโโ ุชูุณูู ุงูู JSON ุงููุทููุจ (ุงููููุฐุฌ) โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
const JSON_TEMPLATE = `
[
  {
    "angle": "ุงุณู ุงูุฒุงููุฉ ุจุงูุฅูุฌููุฒู (pain, compare, bold, transform, offer)",
    "content": {
      "primaryText": "[ุงูุจูุณุช ูุงูู ููุชูุจ ุฒู ูุง ุงูู Formula ุทุงูุจุฉ ุจุงูุธุจุท โ ููุฑุงุช ููุตููุฉ]",
      "headline": "[ุงูุนููุงู ุงููุตูุฑ โ ูุง ูุฒุฏุด ุนู 6 ูููุงุช]",
      "hooks": [
        "[Hook 1]",
        "[Hook 2]",
        "[Hook 3]"
      "adPost": "[ุงูุจูุณุช ุจุตูุบุฉ ูุงุจูุฉ ูููุณุฎ ูุงููุตู ููุฑุงู โ ูุน ุฅูููุฌูุฒ ููุฒุนุฉ ุจุฐูุงุก]",
      "imageStyleName": "[Choose the exact English name of the style you picked from DYNAMIC_TEMPLATES_INSTRUCTION]",
      "imageVariables": {
        "Variable_Name_1": "Your highly creative short English description for this variable",
        "Variable_Name_2": "Your highly creative short English description for this variable"
      },
      "imagePrompt": "[MUST BE HIGHLY DIVERSE EVEY TIME: e.g. Angle 1: Close up of product. Angle 2: Beautiful female model wearing it outdoors. Angle 3: Professional male model in a studio. Angle 4: Lifestyle shot with accessories. Angle 5: Cinematic wide angle. DO NOT use the same description twice. Provide a highly detailed English prompt for an AI image generator based on the dynamically filled template.]"
    }
  }
  // ูุฑุฑ ูุฐุง ูู 5 ุฒูุงูุง ูุฎุชููุฉ
]
`

export interface EnrichmentResult {
  targetGender: string;
  ageRange: string;
  lifestyle: string;
  topPains: string[];
  competitorWeakness: string;
  suggestedTone: string;
  bestAngle: string;
  uniqueInsight: string;
  categoryInsights: string;
  visualStyle: string;
}

export function buildEnrichmentPrompt(data: ProductFormData): string {
  return `
  ุฃูุช ุงูุขู ุฎุจูุฑ ุงุณุชุฑุงุชูุฌู ูู ุงูุชุณููู ูุจุงุญุซ ุฏูููุบุฑุงูู ูุญุชุฑู ููุณูู ุงููุตุฑู ูุงูุฎููุฌู.
  ุญูู ูุฐุง ุงูููุชุฌ ูุงุณุชุฎุฑุฌ ุฃููู ุงูุฒูุงูุง ุงูุจูุนูุฉ ูุฑุคู ุงูุฌูููุฑ ุงูุฏูููุฉ.

  ูุตู ุงูููุชุฌ:
  ${data.productDescription}
  
  ุงูุณุนุฑ:
  ${data.price}

  ุฃุฎุฑุฌ ุงููุชูุฌุฉ ุจุตูุบุฉ JSON ููุท:
  {
    "targetGender": "ููู ูุฐุง ุจุงูุถุจุทุ (ุฑุฌุงู/ูุณุงุก/ุงููู)",
    "ageRange": "ุฃูุซุฑ ูุฆุฉ ุนูุฑูุฉ ูุญุชููุฉ (ูุซุงู: 25-35)",
    "lifestyle": "ุตู ุญูุงุชูู ุงูููููุฉ ูู 5 ูููุงุช",
    "topPains": ["ุฃูู ููุณู ุนููู 1", "ุฃูู ุณุทุญู 2", "ุฃูู ุซุงููู 3"],
    "competitorWeakness": "ูุง ุงูุฐู ููุนูู ูุฐุง ุงูููุชุฌ ูุชูุดู ููู ุงูููุชุฌุงุช ุงูุฃุฎุฑูุ",
    "suggestedTone": "ูุจุฑุฉ ุงูุตูุช ุงููุซุงููุฉ ููุฅุนูุงู (ูุซุงู: ุชุญุฏูุ ุชุนุงุทูุ ูุจุงุดุฑ)",
    "bestAngle": "ุฃูุซุฑ ุฒุงููุฉ ูุฑุจุญุฉ ููุชุฑููุฒ ุนูููุง (ูุซุงู: ููุงูุฉุ ุฎููุ ุฑุงุญุฉ)",
    "uniqueInsight": "ุฑุคูุฉ ูุงุญุฏุฉ ุนู ูุฐุง ุงููุดุชุฑู ูุบูู ุนููุง ุงููุณูููู",
    "categoryInsights": "ุญูููุฉ ุนู ูุฐุง ุงูุณูู (ูุซุงู: ูุดุชุฑู ุงูุนูุงูุฉ ุจุงูุจุดุฑุฉ ูุชุดูููู)",
    "visualStyle": "ููุน ุงูุตูุฑุฉ ุงูุฏููู ุงูุฐู ูููู ุงูุชูุฑูุฑ (Scroll)"
  }
  `;
}

export function buildAdPrompt(data: ProductFormData, enrichment?: EnrichmentResult): string {
  const enrichmentData = enrichment ? `
ูุนูููุงุช ุชุญููู ุงูุฌูููุฑ (ุงุณุชุฎุฏููุง ููุชุงุจุฉ ููุงู ูููุน):
- ุงููุฆุฉ ุงููุณุชูุฏูุฉ: ${enrichment.targetGender} (${enrichment.ageRange})
- ููุท ุงูุญูุงุฉ: ${enrichment.lifestyle}
- ุฃุนูู ุงูุขูุงู: ${enrichment.topPains.join('ุ ')}
- ุงููุจุฑุฉ ุงููุทููุจุฉ: ${enrichment.suggestedTone}
- ุงูุฒุงููุฉ ุงูุฃูู: ${enrichment.bestAngle}
- ููุงุญุธุฉ ุฎููุฉ ุนู ุงูุฌูููุฑ: ${enrichment.uniqueInsight}
  ` : '';

  return `
ุฃูุช ุงูุขู "ุฅุจุฏุงุน ุจุฑู v3" โ ุฃููู ุตุงูุน ุฅุนูุงูุงุช Performance/Direct Response ูู ุงูุดุฑู ุงูุฃูุณุท.
ุดุบูุชู ูุด ุฅูู ุชูุชุจ ููุงู ููููุ ุดุบูุชู ุฅูู ุชูุชุจ ููุงู "ูุจูุน" ุจุงูุนุงููุฉ ุงููุตุฑูุฉ ุงูุฃุตููุฉ.

ุจูุงุกู ุนูู ูุนูููุงุช ุงูููุชุฌ ุงูุขุชูุฉุ ูู ุจุชูููุฏ 5 ุฅุนูุงูุงุช ูุงููุฉ ููุฎุชููุฉ ุชูุงูุงู (ุฒุงููุฉ ููู ุฅุนูุงู).

ูุนูููุงุช ุงูููุชุฌ:
ุงููุตู ูุงูุฃูู ูุงูููุงุฆุฏ (ุชูุงุตูู ุงูููุชุฌ): ${data.productDescription}
ุงูุณุนุฑ: ${data.price}

${enrichmentData}

${LANGUAGE_RULES}

${DYNAMIC_TEMPLATES_INSTRUCTION}

${ANGLE_FORMULAS}

ุงููุทููุจ:
ุฃุฑูุฏ ุงูุฑุฏ ุจุตูุบุฉ JSON array ููุท ูุง ุบูุฑ (ุจุฏูู ุฃู ููุฏูุงุช ุฃู ุดุฑูุญุงุช).
ุงูุชูุณูู ุงููุทููุจ ููู JSON:
${JSON_TEMPLATE}
`
}
